---
import { getLangFromUrl, useTranslations } from '../i18n/utils';

// 1. RÃ©cupÃ©ration de la langue et de la fonction de traduction
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// 2. Configuration de base
const base = '/fordima-academy';
const { currentLocale } = Astro;

// 3. Liste des langues pour le sÃ©lecteur (reste ici car c'est structurel)
const languages = [
  { code: 'en', label: 'EN', flag: 'ðŸ‡¬ðŸ‡§' },
  { code: 'fr', label: 'FR', flag: 'ðŸ‡«ðŸ‡·' },
  { code: 'es', label: 'ES', flag: 'ðŸ‡ªðŸ‡¸' },
  { code: 'ar', label: 'AR', flag: 'ðŸ‡¸ðŸ‡¦' }
];
---

<nav class="k-navbar">
  <div class="k-container k-d-flex k-align-center k-justify-between">
    <a href={`${base}/${currentLocale}/`} class="k-logo k-d-flex k-align-center">
      <img 
        src={`${base}/logo-fordima.png`} 
        alt="Fordima Logo" 
        style="height: 40px; margin-right: 10px;"
      />
      <span class="k-d-none k-d-inline-block">
        FORDIMA <span class="k-text-primary">ACADEMY</span>
      </span>
    </a>

    <div class="k-d-flex k-align-center">
      <ul class="k-nav-links k-mr-4" id="main-menu">
        <li>
          <a href={`${base}/${currentLocale}/docs/`}>
            {t('nav.docs')}
          </a>
        </li>
        <li>
          <a href="#books">
            {t('nav.books')}
          </a>
        </li>
        
        <li class="k-ml-2">
          <select 
            onchange="window.location.pathname = this.value" 
            style="padding: 4px; border-radius: 4px; border: 1px solid #ddd; background: #fff; cursor: pointer;"
          >
            {languages.map((l) => (
              <option 
                value={`${base}/${l.code}/`} 
                selected={currentLocale === l.code}
              >
                {l.flag} {l.label}
              </option>
            ))}
          </select>
        </li>
      </ul>

      <a 
        href="https://github.com/fomadev" 
        class="k-btn k-btn-primary k-btn-sm" 
        target="_blank" 
        rel="noopener noreferrer"
      >
        {t('nav.github')}
      </a>

      <button class="k-burger k-ml-2" data-kitoko="burger" data-target="#main-menu">
        â˜°
      </button>
    </div>
  </div>
</nav>

<style>
    /* Ajustement spÃ©cifique pour le logo en mode RTL */
    [dir="rtl"] img {
        margin-right: 0 !important;
        margin-left: 10px !important;
    }
    
    .k-navbar {
        border-bottom: 1px solid #f1f5f9;
        background-color: #fff; /* Optionnel : assure la lisibilitÃ© */
    }

    /* Petit fix pour l'alignement vertical du select */
    select {
        font-family: inherit;
        font-size: 0.9rem;
    }
</style>